{% extends "peptitions/userPage/main.html" %}
{% load crispy_forms_tags %}

{% block content %}
<main class="flex-1 p-6 md:ml-64 overflow-y-auto">

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">My Petitions</h1>
    <button id="openFormBtn"
       class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
       + Create Petition
    </button>
  </div>

  <!-- Table -->
  <div class="bg-white shadow rounded-lg overflow-x-auto">
    <table class="w-full border-collapse min-w-[600px]">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-3 text-left text-sm font-semibold text-gray-600">#</th>
          <th class="p-3 text-left text-sm font-semibold text-gray-600">Title</th>
          <th class="p-3 text-left text-sm font-semibold text-gray-600">Status</th>
          <th class="p-3 text-left text-sm font-semibold text-gray-600">Created</th>
          <th class="p-3 text-left text-sm font-semibold text-gray-600">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for petition in petitions %}
        <tr class="border-b">
          <td class="p-3">{{ forloop.counter }}</td>
          <td class="p-3">{{ petition.title }}</td>
          <td class="p-3">
            <span class="
              px-2 py-1 rounded-full text-xs
              {% if petition.status == 'pending' %} bg-yellow-100 text-yellow-700
              {% elif petition.status == 'approved' %} bg-green-100 text-green-700
              {% elif petition.status == 'rejected' %} bg-red-100 text-red-700
              {% else %} bg-gray-200 text-gray-600 {% endif %}
            ">
              {{ petition.status|capfirst }}
            </span>
          </td>
          <td class="p-3 text-sm text-gray-500">{{ petition.created_at|date:"M d, Y" }}</td>
          <td class="p-3 flex gap-2">
            
            
            {% if petition.status == "approved" %}
              <span class="text-gray-700 text-sm">
                ✍️ {{ petition.current_signatures }} / {{ petition.required_signatures }}
              </span>
            
            {% elif petition.status == "rejected" %}
              <a href="#" class="text-red-600 hover:underline"
                 onclick="return confirm('Are you sure you want to delete this petition?');">
                 Delete
              </a>

            {% elif petition.status == "pending" %}
              <a href="#" class="text-green-600 hover:underline">Edit</a>
              <a href="#" class="text-red-600 hover:underline"
                 onclick="return confirm('Are you sure you want to delete this petition?');">
                 Delete
              </a>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="p-3 text-center text-gray-500">
            You haven’t created any petitions yet.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</main>

<!-- Modal Form (hidden by default) -->
<div id="petitionModal"
     class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-lg p-6 relative">
    <!-- Close Button -->
    <button id="closeFormBtn"
            class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-xl">&times;</button>
    
    <h2 class="text-xl font-bold mb-4">Create Petition</h2>
    
    <form method="POST" enctype="multipart/form-data" class="space-y-6">
      {% csrf_token %}
      {{ form|crispy }}

      <div class="flex justify-end">
        <button type="submit" 
          class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition">
          Submit Petition
        </button>
      </div>
    </form>
    
  </div>
</div>

<!-- JS -->
<script>
  const openBtn = document.getElementById("openFormBtn");
  const closeBtn = document.getElementById("closeFormBtn");
  const modal = document.getElementById("petitionModal");

  openBtn.addEventListener("click", () => modal.classList.remove("hidden"));
  closeBtn.addEventListener("click", () => modal.classList.add("hidden"));

  // Close on outside click
  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.classList.add("hidden");
    }
  });
</script>
{% endblock %}
